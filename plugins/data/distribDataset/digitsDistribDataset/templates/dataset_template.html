{# Copyright (c) 2016-2017, NVIDIA CORPORATION.  All rights reserved. #}

{% from "helper.html" import print_flashes %}
{% from "helper.html" import print_errors %}
{% from "helper.html" import mark_errors %}

<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='webuploader/webuploader.css', ver=dir_hash) }}">
    <script src="{{ url_for('static', filename='webuploader/webuploader.min.js') }}"></script>
</head>

<div class="form-group">
    <label for="sp_pic_dir" class="control-label">Upload Dataset</label>
    <span class="explanation-tooltip glyphicon glyphicon-question-sign"
        title="upload dataset to training server."
    ></span>
    <div style="margin:0px 0 0 0px;">
	    <div id="picker" style="float:left;">choose dataset</div>
	    <div style="clear:both;"></div>
	</div>
	<small>Package before upload</small>
	<div id="progress" class="progress2" style="width:540px;float:left;margin:5px 0px 10px 0px;">
	    <div class="progress-bar progress-bar-striped active" role="progressbar" style="width:0%;"></div>
	</div>
	<script type="text/javascript">
		$(document).ready(function() {
		    var task_id = WebUploader.Base.guid();
		    var uploader = WebUploader.create({
		        swf: "{{ url_for('static', filename='webuploader/Uploader.swf') }}",
		        server: '{{ url_for("digits.dataset.generic.views.upload", extension_id='ssd_pascal') }}',
		        pick: '#picker',
		        auto: true,
		        chunked: true,
		        chunkSize: 20 * 1024 * 1024,
		        chunkRetry: 3,
		        threads: 1,
		        duplicate: true,
		        formData: {
		            task_id: task_id,
		        },
		    });

		    uploader.on('startUpload', function() {
		        $('#progress').show();
		        $('.progress-bar').css('width', '0%');
		        $('.progress-bar').text('0%');
		        $('.progress-bar').removeClass('progress-bar-danger progress-bar-success');
		        $('.progress-bar').addClass('active progress-bar-striped');
		    });

		    uploader.on('uploadProgress', function(file, percentage) {
		        $('.progress-bar').css('width', percentage * 100 - 1 + '%');
		        $('.progress-bar').text(Math.floor(percentage * 100 - 1) + '%');
		    });

		    uploader.on('uploadSuccess', function(file) {
		        var data = {'task_id': task_id, 'ext': file.source['ext'], 'type': file.source['type']};
		        $.get('{{ url_for("digits.dataset.generic.views.upload_success", extension_id='ssd_pascal') }}', data);
		        $('.progress-bar').css('width', '100%');
		        $('.progress-bar').text('100%');
		        $('.progress-bar').addClass('progress-bar-success');
		        $('.progress-bar').text('successed');
		    });

		    uploader.on('uploadError', function(file) {
		        $('.progress-bar').css('width', '100%');
		        $('.progress-bar').text('100%');
		        $('.progress-bar').addClass('progress-bar-danger');
		        $('.progress-bar').text('failed');
		    });

		    uploader.on('uploadComplete', function(file) {
		        $('.progress-bar').removeClass('active progress-bar-striped');
		    });

		    $('#progress2').hide();
		});
	</script>
</div>

<div class="form-group{{mark_errors([form.voc_folder])}}">
    {{ form.voc_folder.label }}
    {{ form.voc_folder.tooltip }}
    {{ form.voc_folder(class='form-control autocomplete_path', placeholder='folder') }}
</div>

